<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="assets/img/LOGO_Branca.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="assets/css/home.css">
    <link rel="stylesheet" href="assets/css/singer.css">
    <title>All About</title>
</head>

<body>
    <header>
        <div class="container">
            <a class="img-logo" href="#"><img src="assets/img/LOGO_Branca.png" alt="Logo"></a>
            <div class="navbar">
                <ul class="list">
                    <li>
                        <span id="logout">Sair</span>
                        <span id="name_user">NomeUsuário</span>
                    </li>
                </ul>
            </div>
        </div>
    </header>

    <section class="singer-image">

        <div class="title-image">
            <div class="container container-image">
                <h1 class="title title-site">All About</h1>
                <div class="image">
                    <h1 class="title title-name">TIM MAIA</h1>
                </div>
            </div>

        </div>

    </section>

    <section class="who-was">
        <div class="container">
            <h2 class="title">Quem foi Tim Maia?</h2>
            <div class="bio">
                <p class="text">
                    Tim Maia (1942-1998) foi um cantor e compositor brasileiro que fez sucesso com canções que
                    representam o
                    melhor do pop nacional, entre elas, “Azul da Cor do Mar”, “Primavera”, “Me dê Motivo”, “Não Quero
                    Dinheiro, Só Quero Amar”, “Gostava Tanto de Você” e “Sossego”.
                </p>
                <p class="text">
                    Tim Maia, nome artístico de Sebastião Rodrigues Maia, nasceu no Rio de Janeiro, no bairro da Tijuca,
                    no
                    dia 28 de setembro de 1942. Caçula de doze irmãos, quando criança, ajudava a família entregando
                    marmitas. Com oito anos cantava no coral da Igreja. Em 1957 criou o grupo “The Sputniks”, formado
                    por
                    Roberto Carlos e outros cantores.
                </p>
                <p class="text">
                    Em 1959, foi tentar a sorte nos Estados Unidos. Ficou hospedado, em Tarrytows, na casa de uma
                    família
                    que conhecera no Brasil. A cidade, a 40 km de Nova York, tinha pouco mais de 11 mil habitantes e
                    abrigava a efervescência do jazz e da música negra. Nessa sua turnê americana, Sebastião era chamado
                    de
                    “Jim”, porque os americanos não conseguiam pronunciar “Tião”, seu apelido da juventude.
                </p>
                <p class="text">
                    No início, integrou uma banda de Twist, depois foi convidado pelo músico americano Roger Bruno, para
                    se
                    juntar ao “Ideals”. Tim ficou responsável pela harmonia e pela guitarra. A banda lançou um único
                    disco,
                    com as músicas “New Love” (parceria de Tim com Roger) e Go Ahead and Cry. Rebelde, Tim Maia passou a
                    praticar pequenas transgressões: pulava a catraca do trem e furtava comida no supermercado. No fim
                    de
                    1963, foi preso por roubo e porte de droga. Passou seis meses na prisão e em 1964 foi deportado do
                    país.
                </p>
                <p class="text">
                    De volta ao Brasil, Tim Maia conjugou tudo o que aprendeu da música negra americana, com ritmos
                    brasileiros como samba e baião. Produziu o disco “A Onda é o Boogaloo” de Eduardo Araújo. Teve
                    composições gravadas por Roberto Carlos (Não Vou Ficar) e Erasmo Carlos (Não Quero Nem Saber).
                    Começou a
                    se apresentar em programas de rádio e TV.
                </p>
                <p class="text">
                    Em 1970, gravou seu primeiro LP, “Tim Maia”, que fez sucesso com as músicas “Azul da Cor do Mar”,
                    “Coronel Antônio Bento”, “Primavera” e “Eu Amo Você”. Em 1971, lançou “Tim Maia”, que fez sucesso
                    com
                    “Não Quero Dinheiro, Só Quero Amar”, uma canção dançante de sua autoria, “Não Vou Ficar” e “Preciso
                    Aprender a Ser Só”. Em 1975, lançou “Rational Culture”, que fez parte da fase mística do cantor,
                    quando
                    ele se filiou à seita, Universo em Desencanto.
                </p>
                <p class="text">
                    Com histórico de atritos com as gravadoras, foi um dos primeiros artistas a lançar seu próprio selo
                    “Seroma”, que depois virou a gravadora “Vitória Régia”. Com ela lançou “Que Beleza”, “Descobridor
                    dos
                    Sete Mares”, “Me Dê Motivo” etc.
                </p>
                <p class="text">
                    Com seu comportamento polêmico, faltou a shows e entrevistas e se queixava do sistema de som dos
                    locais
                    em que se apresentava. Os pedidos de “mais grave, mais agudo, mais retorno” viraram rotina, pois ele
                    repetia em todas as apresentações. Envolvido com álcool e drogas, vivia com a saúde debilitada.
                    Durante
                    uma apresentação, no dia 8 de março de 1998, no Teatro Municipal de Niterói, passando mal,
                    retirou-se do
                    palco e foi levado para o hospital.

                </p>
                <p class="text">
                    Tim Maia faleceu em Niterói, no Rio de Janeiro, no dia 15 de março de 1998.
                </p>
            </div>
        </div>
    </section>

    <section class="songs">
        <div class="container-songs">
            <div class="boxes">
                <div class="title-box">
                    <h3>Minha música favortita do Tim Maia</h3>
                    <h3>Qual a sua música favorita de Tim Maia?</h3>
                </div>
                <div class="container-boxes">
                    <div class="box-my-music">
                        <div class="legend-box">
                            <img src="assets/img/album.png">
                            <div class="subtitle">
                                <p>Bom Senso</p>
                                Álbum: Racional V1 - 1975
                            </div>
                        </div>
                    </div>
                    <div class="box-music-1">
                        <div class="legend-box">
                            <img class="image-box" src="assets/img/album.png">
                            <div class="subtitle">
                                <p>Rarional Culture</p>
                                Álbum: Racional V1 - 1975
                            </div>
                        </div>
                    </div>
                    <div class="box-music-2">
                        <div class="legend-box">
                            <img class="image-box" src="assets/img/album.png">
                            <div class="subtitle">
                                <p>Universo Em Densencanto</p>
                                Álbum: Racional V1 - 1975
                            </div>
                        </div>
                    </div>
                    <div class="box-music-3">
                        <div class="legend-box">
                            <img class="image-box" src="assets/img/album.png">
                            <div class="subtitle">
                                <p>Imunização Racional</p>
                                Álbum: Racional V1 - 1975
                            </div>
                        </div>
                    </div>
                    <div class="box-music-4">
                        <div class="legend-box">
                            <img class="image-box" src="assets/img/album.png">
                            <div class="subtitle">
                                <p>Contacto Com o mundo Racional</p>
                                Álbum: Racional V1 - 1975
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="votation">
        <div class="container-chart">
            <div class="choose-votation">
                <h3>Vote Aqui: </h3>
                <div class="options">
                    <button id="music1" class="button button-1">Bom Senso</button>
                    <button id="music2" class="button button-2">Universo Em Desencanto</button>
                    <button id="music3" class="button button-3">Imunização Racional</button>
                    <button id="music4" class="button button-4">Contacto Com o Mundo Racional</button>
                </div>
            </div>
            <div class="chart-js">
                <canvas id="chart"></canvas>
            </div>
        </div>
    </section>

    <footer>
        <div class="container-footer">
            <div class="content">
                <div class="find-us">
                    <h2>Nos encontre aqui</h2>
                    <div class="icons">
                        <a href="https://www.instagram.com/" target="_blank"><img src="assets/img/instagram.png"
                                alt="Instagram" class="social"></a>
                        <a href="https://www.facebook.com/" target="_blank"><img src="assets/img/facebook.png"
                                alt="Facebook" class="social"></a>
                        <a href="https://twitter.com/" target="_blank"><img src="assets/img/twitter.png" alt="Twitter"
                                class="social"></a>
                        <a href="https://www.youtube.com/" target="_blank" class="social"><img
                                src="assets/img/youtube.png" alt="Youtube" class="social"></a>
                        <a href="https://www.linkedin.com/" target="_blank" class="social"><img
                                src="assets/img/linkedin.png" alt="Linkedin" class="social"></a>
                    </div>
                </div>
                <div class="professional-contact">
                    <h2>Contato Profissional</h2>
                    <span>allabout_profissional@at.com</span>
                    <img src="assets/img/email.png" alt="Email">
                </div>
                <div class="project">
                    <h2>Projeto desenvolvido para</h2>
                    <img src="assets/img/sptech.png" alt="Logo Sptech">
                </div>
            </div>
            <div class="baseboard">
                <span>Pensado e desenvolvido por Carlos Eduardo </span>
                <div class="location">
                    <img src="assets/img/localizacao.png" alt="Icone localização">
                    <span>São Paulo, Capital</span>
                </div>
                <span>Todos os direitos reservados© 2022 All About</span>
            </div>
        </div>
    </footer>

</body>

</html>
<script>

    name_user.innerHTML = sessionStorage.NOME_USUARIO;

    let proximaAtualizacao;

    window.onload = obterDadosGrafico(1);

    verificar_autenticacao();

    function alterarTitulo(idAquario) {
        var tituloAquario = document.getElementById("tituloAquario")
        tituloAquario.innerHTML = "Últimas medidas de Temperatura e Umidade do <span style='color: #e6005a'>Aquário " + idAquario + "</span>"
    }

    // O gráfico é construído com três funções:
    // 1. obterDadosGrafico -> Traz dados do Banco de Dados para montar o gráfico da primeira vez
    // 2. plotarGrafico -> Monta o gráfico com os dados trazidos e exibe em tela
    // 3. atualizarGrafico -> Atualiza o gráfico, trazendo novamente dados do Banco

    // Esta função *obterDadosGrafico* busca os últimos dados inseridos em tabela de medidas.
    // para, quando carregar o gráfico da primeira vez, já trazer com vários dados.
    // A função *obterDadosGrafico* também invoca a função *plotarGrafico*

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    function obterDadosGrafico(idAquario) {
        alterarTitulo(idAquario)

        if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }

        fetch(`/medidas/ultimas/${idAquario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta, idAquario);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta, idAquario) {
        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        // let dados = {
        //     labels: labels,
        //     datasets: [{
        //         label: 'Umidade',
        //         data: [],
        //         fill: false,
        //         borderColor: 'rgb(75, 192, 192)',
        //         tension: 0.1
        //     },
        //     {
        //         label: 'Temperatura',
        //         data: [],
        //         fill: false,
        //         borderColor: 'rgb(199, 52, 52)',
        //         tension: 0.1
        //     }]
        // };
        const data = {
            datasets: [{
                label: 'Votção',
                data: [300, 50, 100, 50],
                backgroundColor: [
                    'rgb(132, 160, 131)',
                    'rgb(243, 101, 34)',
                    'rgb(99, 115, 144)',
                    'rgb(254,229,90)'
                ],
                hoverOffset: 4
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.momento_grafico);
            dados.datasets[0].data.push(registro.umidade);
            dados.datasets[1].data.push(registro.temperatura);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        // Criando estrutura para plotar gráfico - config
        // const config = {
        //     type: 'line',
        //     data: dados,
        // };

        const config = {
            type: 'doughnut',
            data: data,
        };

        // Adicionando gráfico criado em div na tela
        // let myChart = new Chart(
        //     document.getElementById('chart'),
        //     config
        // );
        const ChartJs = new Chart(
            document.getElementById('chart'),
            config
        );

        setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
    }


    // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
    // buscando a última medida inserida em tabela contendo as capturas, 

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models
    function atualizarGrafico(idAquario, dados, myChart) {

        fetch(`/medidas/tempo-real/${idAquario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {

                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dados);

                    document.getElementById("avisoCaptura").innerHTML = ""

                    if (novoRegistro[0].momento_grafico == dados.labels[dados.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        document.getElementById("avisoCaptura").innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].momento_grafico)
                        console.log("Horário do último dado capturado:")
                        console.log(dados.labels[dados.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // tirando e colocando valores no gráfico
                        dados.labels.shift(); // apagar o primeiro
                        dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

                        dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                        dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade

                        dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
                        dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

                        myChart.update();
                    }

                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

    }

</script>